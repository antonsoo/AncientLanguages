# Railway deployment configuration for PRAVIEL FastAPI backend
# Documentation: https://docs.railway.com/reference/config-as-code

[build]
# Use the Dockerfile for consistent builds
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

# Only rebuild when backend code changes
watchPatterns = [
  "backend/**",
  "Dockerfile",
  "pyproject.toml",
  "alembic.ini",
  "alembic.docker.ini"
]

[deploy]
# Railway will automatically detect PORT from environment
# Run database migrations before starting the server to ensure schema is up to date
startCommand = "python -m alembic upgrade head && uvicorn app.main:app --host 0.0.0.0 --port $PORT"

# Restart policy for resilience
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# Health check configuration
healthcheckPath = "/health"
healthcheckTimeout = 300
